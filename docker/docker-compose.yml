zookeeper:
  image: wurstmeister/zookeeper
  container_name: zookeeper
  hostname: zookeeper
  ports:
    - "2181:2181"

kafka:
  image: wurstmeister/kafka:0.9.0.0-1
  container_name: kafka
  ports:
    - "9092:9092"
    - "9999:9999"
  links:
    - zookeeper
  environment:
    KAFKA_ADVERTISED_HOST_NAME: 100.0.0.205
    KAFKA_CREATE_TOPICS: "eventor_webserver:20:1"
    KAFKA_ZOOKEEPER_CONNECT: "zookeeper:2181"
    KAFKA_DELETE_TOPIC_ENABLE: "true"
    KAFKA_LOG_RETENTION_HOURS: 1
    KAFKA_MESSAGE_MAX_BYTES: 100000000
    KAFKA_REPLICA_FETCH_MAX_BYTES: 100000000
    KAFKA_GROUP_MAX_SESSION_TIMEOUT_MS: 60000
    KAFKA_NUM_PARTITIONS: 20
    JMX_PORT: 9999
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock

kafka_manager:
    image: sheepkiller/kafka-manager:1.3.0.8
    container_name: kafka_manager
    hostname: kafka_manager
    links:
        - zookeeper
        - kafka
    ports:
        - "9000:9000"
    environment:
        ZK_HOSTS: "zookeeper:2181"
        KM_VERSION: "1.3.0.8"
        KM_REVISION: "6e196ea7a332471bead747535f9676f0a2bad008"

eventor_webserver:
    container_name: eventor_webserver
    build: eventor_webserver
    hostname: eventor_webserver
    links:
       - kafka
    ports:
        - 80:80
    environment:
        FLUME_CONF_FILE: /opt/flume/conf/flume.conf
        FLUME_AGENT_NAME: a1
        FLUME_PLUGINS_DIRECTORY: /opt/flume/plugins.d/
        FLUME_JAVA_OPTIONS: "-Xms1024m -Xmx2048m -Xss256k -XX:MaxDirectMemorySize=256m -XX:+UseParNewGC -XX:+UseConcMarkSweepGC"

elasticsearch:
    image: elasticsearch:2.2
    container_name: elasticsearch
    hostname: elasticsearch
    expose:
       - 9200
       - 9300
    ports:
        - 9200:9200
        - 9300:9300
    volumes:
        - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
        - ./elasticsearch/config/logging.yml:/usr/share/elasticsearch/config/logging.yml

kibana:
    image: kibana:4.4.1
    container_name: kibana
    hostname: kibana
    ports:
        - 5601:5601
    links:
        - elasticsearch

jobmanager:
    build: flink
    container_name: jobmanager
    ports:
        - 48080:8080
        - 6123:6123
    expose:
        - 22
        - 6123
        - 8081
    command: /usr/local/flink/bin/config-flink.sh jobmanager
    links:
        - kafka
        - elasticsearch
worker:
    build: flink
    container_name: worker
    expose:
        - 6121
        - 6122
    links:
        - jobmanager
        - kafka
        - elasticsearch
    command: /usr/local/flink/bin/config-flink.sh taskmanager

locust:
    container_name: locust
    build: locust
    hostname: locust
    links:
        - eventor_webserver
    ports:
        - 8089:8089
    environment:
        TARGET_URL: "http://100.0.0.205/"